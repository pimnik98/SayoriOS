name: ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Just lists all version of clang
        run: sudo apt list "clang-*"

      - name: Step 1 - Software installation
        run: |
          sudo apt install python3 build-essential xorriso grub-pc-bin mtools llvm lld fasm zip doxygen

      - name: Step 2 - Compiling the kernel
        run: make

      - name: Step 3 - ISO assembly
        run: make geniso

      - name: Step 4 - Preparing for DoxyGen
        run: |
          rm -rf docs/doxygen/
          sudo doxygen Doxyfile
          ls docs/doxygen/
          ls

      - name: Step 5 - File Existence Check
        run: |
          echo "done!"
          ls iso/boot/
          ls

      - name: Step 6 - Updating documentation with DoxyGen
        uses: EndBug/add-and-commit@v9
        with:
          author_name: Github
          author_email: github@example.com
          message: 'üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é doxygen'
          add: 'docs/doxygen/html/*'

      - name: Step 8 - Update to the latest unstable release
        uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.SAYORI }}"
          automatic_release_tag: "latest-unstable"
          prerelease: true
          title: "üíΩ SayoriOS Soul- [–ê–≤—Ç–æ—Å–±–æ—Ä–∫–∞] –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑"
          description: "–í–Ω–∏–º–∞–Ω–∏–µ! –î–∞–Ω–Ω—ã–π —Ä–µ–ª–∏–∑ —Å–æ–±—Ä–∞–Ω –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —è–¥—Ä–µ! –≠—Ç–æ –Ω–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏ –∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –∑–∞–ø—É—Å–∫—É –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ."
          files: |
            LICENSE
            kernel.iso
            isodir/boot/initrd.tar
            isodir/boot/kernel.elf
            docs/doxygen/rtf/refman.rtf
